<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
  <h1>AJAX</h1>
  <button>点击调用</button>
  <script>
    function sendAJAX(url) {
      return new Promise(((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET',url);
        xhr.send();
        xhr.onreadystatechange = function () {
          if(xhr.readyState === 4) {
            if(xhr.status >=200 && xhr.status < 300){
              resolve(xhr.response);
            }else{
              reject(xhr.status);
            }
          }
        }
      }));
    }
    let btn = document.querySelector('button');
    btn.addEventListener('click', async function () {
      // async 方法
      let funny = await sendAJAX('https://api.apiopen.top/getJoke');
      console.log(funny);


      // 封装
      // const p = new Promise((resolve, reject) => {
      //   const xhr = new XMLHttpRequest();
      //   xhr.open('GET','https://api.apiopen.top/getJoke');
      //   xhr.send();
      //   xhr.onreadystatechange = function () {
      //     if(xhr.readyState === 4) {
      //       if(xhr.status >=200 && xhr.status < 300){
      //         resolve(xhr.response);
      //       }else{
      //         reject(xhr.status);
      //       }
      //     }
      //   }
      //
      // });
      // 调用
      // p.then(value => {
      //   console.log(value);
      // },reason => {
      //   console.warn(reason);
      // });


    });


  </script>
</body>
</html>